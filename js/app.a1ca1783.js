(function(){"use strict";var e={1744:function(e,l,a){var n=a(9242),t=a(2578),o=a(8412),i=(a(4415),a(2483)),u=a(3396),r=a(4870),s=a(7139),c=a(5939);const d=c.Z.create({baseURL:"http://101.133.234.110:11202/"});let m;d.interceptors.request.use((e=>(m=localStorage.getItem("token"),m&&(e.header["Authorization"]=m),e.headers["Content-Encoding"]="gzip",e))),d.interceptors.response.use((e=>e.result||e.data||e),(e=>{console.error(error)}));const v=e=>d.get("/Panorama/GetAllPanorama",{params:e}),f=e=>d.post("/Panorama/AddPanoramaGroup",e),p=e=>d.delete("Panorama/DeletePanoramaGroup",{params:e}),g=e=>d.post("/Symbol/GetKrpanoSence",e),h=e=>d.delete("Panorama/DeletePanorama",{params:e}),w=(0,t.Q_)("store",{state:()=>({panoTree:[],loading:!1}),actions:{getPanoTree(){return this.loading=!1,v().then((e=>(e.forEach((e=>{e.label=e.groupname,e.panoramas.forEach((e=>{e.label=e.name,e.url=e.foldername})),e.children=e.panoramas})),this.panoTree=e,this.loading=!0,this.panoTree)))}}});var k=a(7178);const y=e=>((0,u.dD)("data-v-5b1a9423"),e=e(),(0,u.Cn)(),e),_={class:"tree-container"},b=(0,u.Uk)("添加组"),C={class:"custom-tree-node"},P=["onClick"],D=["onClick"],z=["onClick"],I=["onClick"],V=(0,u.Uk)("选择文件"),q=y((()=>(0,u._)("div",{class:"el-upload__tip"},"请上传全景图",-1))),x={style:{width:"100%","text-align":"end"}},j=(0,u.Uk)("取消"),H=(0,u.Uk)("生成全景"),T={class:"dialog-footer"},W=(0,u.Uk)("取消"),U=(0,u.Uk)("确认添加"),O=["src"];var S={__name:"index",setup(e){const l=(0,i.tv)();let a=null;const n=(0,r.iH)(),t=((0,r.iH)(),(0,r.iH)()),o=(0,r.iH)(),c=w(),d=(0,r.iH)(""),m=(0,r.iH)(!1),v=(0,r.iH)(!1),y=(0,r.iH)(!1),S=(0,r.iH)(!1),E=(0,r.qj)({name:""}),K=(0,r.qj)({name:"",imgs:[],imgsId:[]}),$=(0,r.qj)({name:[{required:!0,message:"不能为空",trigger:"blur"}]});function N(){o.value.validate(((e,l)=>{e?f(E).then((e=>{(0,k.z8)({message:e.msg,type:"success"}),c.getPanoTree(),y.value=!1,Q(E)})).catch((e=>{(0,k.z8)({message:"添加失败",type:"warning"}),console.error(e)})):console.log("error submit!",l)}))}function G(e){p({id:e.id}).then((e=>{(0,k.z8)({message:e.msg,type:"success"}),c.getPanoTree()})).catch((e=>{(0,k.z8)({message:"删除失败",type:"warning"})}))}function L(e){h({id:e.id}).then((e=>{(0,k.z8)({message:e.msg,type:"success"}),c.getPanoTree()})).catch((e=>{(0,k.z8)({message:"删除失败",type:"warning"})}))}function A(e){d.value=e.url,m.value=!0}function F(e){const l=K.imgsId.indexOf(e.uid);if(K.imgsId.splice(l,1),e.response){const l=K.imgs.indexOf(e.response[0]);K.imgs.splice(l,1)}}function M(e,l){const a=K.imgsId.indexOf(l.uid);K.imgsId.splice(a,1),K.imgs.push(e[0])}function B(e){K.imgsId.push(e.uid)}function Q(e){for(let l in e)"string"==typeof e[l]||"number"==typeof e[l]?e[l]="":e[l]instanceof Array?e[l]=[]:e[l]=null}function R(){t.value.validate(((e,l)=>{if(e){if(K.imgsId.length)return(0,k.z8)({message:"请等待文件上传完成",type:"warning"});if(0===K.imgs.length)return(0,k.z8)({message:"未上传全景图",type:"warning"});Y({groupName:a.label,name:K.name,groupId:a.id,paths:K.imgs})}else console.log("error submit!",l)}))}function Y(e){S.value=!0,(0,k.z8)({message:`正在生成全景图,全景图名称：${e.name},所属分组: ${e.groupName}`}),g(e).then((l=>{c.getPanoTree(),(0,k.z8)({message:`全景图生成完成,全景图名称：${e.name},所属分组: ${e.groupName}`,type:"success"}),v.value=!1,Q(K)})).catch((l=>{console.error(l),(0,k.z8)({message:`全景图生成失败,全景图名称：${e.name},所属分组: ${e.groupName}`,type:"warning"})})).finally((()=>{S.value=!1}))}function Z(e,l){a=e,v.value=!0}function J(e,a){if(1===a.level){if(0===e.children.length)return(0,k.z8)({message:"请先添加全景图",type:"warning"});l.push({name:"KrpanoViewer",query:{groupId:e.id}})}else l.push({name:"KrpanoViewer",query:{groupId:a.parent.data.id,panoId:e.id}})}return(e,l)=>{const a=(0,u.up)("el-button"),i=(0,u.up)("el-tree"),f=(0,u.up)("el-input"),p=(0,u.up)("el-form-item"),g=(0,u.up)("el-upload"),h=(0,u.up)("el-form"),w=(0,u.up)("el-dialog"),k=(0,u.Q2)("loading");return(0,u.wg)(),(0,u.iD)("div",_,[(0,u.Wm)(a,{onClick:l[0]||(l[0]=e=>{y.value=!0}),style:{"margin-bottom":"10px"}},{default:(0,u.w5)((()=>[b])),_:1}),(0,u.Wm)(i,{class:"tree",data:(0,r.SU)(c).panoTree,"node-key":"id","default-expand-all":"","expand-on-click-node":!1},{default:(0,u.w5)((({node:e,data:l})=>[(0,u._)("span",C,[(0,u._)("span",null,(0,s.zw)(e.label),1),(0,u._)("span",null,[(0,u._)("a",{onClick:a=>J(l,e)},"查看",8,P),1===e.level?((0,u.wg)(),(0,u.iD)("a",{key:0,style:{"margin-left":"8px"},onClick:a=>G(l,e)},"删除组",8,D)):(0,u.kq)("",!0),1===e.level?((0,u.wg)(),(0,u.iD)("a",{key:1,style:{"margin-left":"8px"},onClick:a=>Z(l,e)},"添加全景图",8,z)):(0,u.kq)("",!0),2===e.level?((0,u.wg)(),(0,u.iD)("a",{key:2,style:{"margin-left":"8px"},onClick:a=>L(l,e)},"删除全景图",8,I)):(0,u.kq)("",!0)])])])),_:1},8,["data"]),(0,u.Wm)(w,{"close-on-click-modal":!1,modelValue:v.value,"onUpdate:modelValue":l[3]||(l[3]=e=>v.value=e),title:"添加全景图","destroy-on-close":"","show-close":!1},{default:(0,u.w5)((()=>[(0,u.wy)(((0,u.wg)(),(0,u.j4)(h,{ref_key:"panoFormDom",ref:t,model:K,rules:$},{default:(0,u.w5)((()=>[(0,u.Wm)(p,{prop:"name",label:"全景图名称","label-width":e.formLabelWidth},{default:(0,u.w5)((()=>[(0,u.Wm)(f,{modelValue:K.name,"onUpdate:modelValue":l[1]||(l[1]=e=>K.name=e),autocomplete:"off"},null,8,["modelValue"])])),_:1},8,["label-width"]),(0,u.Wm)(g,{ref_key:"uploadRef",ref:n,class:"upload-demo",action:"http://101.133.234.110:11202/File/SenceImageFileUpload","auto-upload":!0,multiple:"",accept:".jpg","list-type":"picture-card",name:"files",data:{Module:"panoFile"},onPreview:A,onRemove:F,onSuccess:M,"before-upload":B},{trigger:(0,u.w5)((()=>[(0,u.Wm)(a,{type:"primary"},{default:(0,u.w5)((()=>[V])),_:1})])),tip:(0,u.w5)((()=>[q])),_:1},512),(0,u._)("div",x,[(0,u.Wm)(a,{onClick:l[2]||(l[2]=e=>{v.value=!1,Q(K)})},{default:(0,u.w5)((()=>[j])),_:1}),(0,u.Wm)(a,{type:"primary",onClick:R},{default:(0,u.w5)((()=>[H])),_:1})])])),_:1},8,["model","rules"])),[[k,S.value]])])),_:1},8,["modelValue"]),(0,u.Wm)(w,{"close-on-click-modal":!1,modelValue:y.value,"onUpdate:modelValue":l[6]||(l[6]=e=>y.value=e),title:"添加组","destroy-on-close":"","show-close":!1},{footer:(0,u.w5)((()=>[(0,u._)("span",T,[(0,u.Wm)(a,{onClick:l[5]||(l[5]=e=>{y.value=!1,Q(E)})},{default:(0,u.w5)((()=>[W])),_:1}),(0,u.Wm)(a,{type:"primary",onClick:N},{default:(0,u.w5)((()=>[U])),_:1})])])),default:(0,u.w5)((()=>[(0,u.Wm)(h,{ref_key:"groupFormDom",ref:o,model:E,rules:$},{default:(0,u.w5)((()=>[(0,u.Wm)(p,{prop:"name",label:"组名称","label-width":e.formLabelWidth},{default:(0,u.w5)((()=>[(0,u.Wm)(f,{modelValue:E.name,"onUpdate:modelValue":l[4]||(l[4]=e=>E.name=e),autocomplete:"off"},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),(0,u.Wm)(w,{modelValue:m.value,"onUpdate:modelValue":l[7]||(l[7]=e=>m.value=e)},{default:(0,u.w5)((()=>[(0,u._)("img",{"w-full":"",src:d.value,alt:"Preview Image"},null,8,O)])),_:1},8,["modelValue"])])}}},E=a(89);const K=(0,E.Z)(S,[["__scopeId","data-v-5b1a9423"]]);var $=K;function N(e,l){return new Promise((a=>{const n=M(l);embedpano({xml:n.xml,target:e,html5:"only",mobilescale:1,passQueryParameters:"startscene,startlookat",onready:e=>{e.set("layer.visible",!1),a(e)}})}))}function G(e,l){const a=M(l);e.call(`loadpano(${a.xml}, null, MERGE, BLEND(0));`)}function L(e){const l=[];for(var a=e.get("scene.count"),n=0;n<a;n++){const a=e.get("scene").getItem(n);l.push(a)}return l}function A(e,l,a=1){l?e.call(`loadscene(${l}, null, KEEPMOVING, BLEND(${a}));`):e.call(`loadscene(get(startscene), null, KEEPMOVING, BLEND(${a}));`)}function F(e){return{hlookat:e.get("view.hlookat"),vlookat:e.get("view.vlookat"),fov:e.get("view.fov")}}function M(e){const l=e+"/tour.xml";return{xml:l}}const B=e=>((0,u.dD)("data-v-38bffafc"),e=e(),(0,u.Cn)(),e),Q={class:"container"},R=B((()=>(0,u._)("div",{id:"pano-left",class:"pano"},null,-1))),Y=[R],Z=B((()=>(0,u._)("div",{id:"pano-right",class:"pano"},null,-1))),J=[Z],X={key:0,class:"menu"},ee={class:"menu-header"},le={class:"menu-bottom"},ae={key:1,class:"menu"},ne={class:"menu-header"},te={class:"menu-bottom"},oe={style:{color:"#fff"}},ie={style:{color:"#fff"}},ue={key:2,class:"menu"},re={class:"menu-header"},se={key:0,class:"menu-bottom1"},ce=["onClick"],de=["src"],me={key:1,class:"menu-bottom1"},ve=["onClick"],fe=["src"];var pe={__name:"index",setup(e){const l=(0,i.yj)(),a=(0,i.tv)(),n=w(),t=l.query;let o,c;const d=(0,r.iH)(""),m=(0,r.iH)(""),v=(0,r.iH)([]),f=(0,r.iH)([]),p=(0,r.iH)(),g=(0,r.iH)(),h=(0,r.iH)(!1),k=(0,r.iH)("main");let y,_=null;const b=(0,r.qj)(t.groupId?n.panoTree.find((e=>e.id==t.groupId)):n.panoTree[0]);function C(){P(),y=setInterval((()=>{_&&o&&c&&(q(o,c),q(c,o))}),20)}function P(){y&&clearInterval(y)}function D(e){if("left"===e){v.value=L(o);let e=v.value.find((e=>e.name===g.value.name));e?(A(o,e.name,0),p.value=e):(A(o,v.value[0].name,0),p.value=v.value[0])}if("right"===e){f.value=L(c);let e=f.value.find((e=>e.name===p.value.name));e?(A(c,e.name,0),g.value=e):(A(c,f.value[0].name,0),g.value=f.value[0])}}function z(){h.value?P():(c||(m.value=b.children[0].id,N("pano-right",b.children[0].url).then((e=>{c=e,setTimeout((()=>{D("right")}),300)}))),C()),h.value=!h.value}function I(e){let l=v.value.find((l=>e.name===l.name));l&&(A(o,e.name),p.value=e);let a=f.value.find((l=>e.name===l.name));a&&(A(c,e.name),g.value=e)}function V(e,l){if("leftPano"===l)for(let a=0;a<b.children.length;a++){const l=b.children[a];if(l.id==e){G(o,l.url),h.value?setTimeout((()=>{D("left")}),300):setTimeout((()=>{v.value=L(o);let e=v.value.find((e=>e.name===p.value.name));e?(A(o,e.name,0),p.value=e):(A(o,v.value[0].name,0),p.value=v.value[0])}),300);break}}else if("rightPano"===l)for(let a=0;a<b.children.length;a++){const l=b.children[a];if(l.id==e){G(c,l.url),setTimeout((()=>{D("right")}),300);break}}}function q(e,l){const a=F(e);a.hlookat!==_.hlookat&&(_.hlookat=a.hlookat,l.set("view.hlookat",a.hlookat)),a.vlookat!==_.vlookat&&(_.vlookat=a.vlookat,l.set("view.vlookat",a.vlookat)),a.fov!==_.fov&&(_.fov=a.fov,l.set("view.fov",a.fov))}return(0,u.bv)((()=>{if(t.panoId){d.value=t.panoId;for(let e=0;e<b.children.length;e++){const l=b.children[e];if(l.id==t.panoId){N("pano-left",l.url).then((e=>{o=e,_=F(o),setTimeout((()=>{v.value=L(o),p.value=v.value[0]}),300)}));break}}}else d.value=b.children[0].id,N("pano-left",b.children[0].url).then((e=>{o=e,_=F(o),setTimeout((()=>{v.value=L(o),p.value=v.value[0]}),300)})),b.children[1]&&(m.value=b.children[1].id,N("pano-right",b.children[1].url).then((e=>{h.value=!0,c=e,C(),setTimeout((()=>{D("right")}),300)})))})),(0,u.Ah)((()=>{P()})),(e,l)=>{const n=(0,u.up)("el-radio"),t=(0,u.up)("el-radio-group");return(0,u.wg)(),(0,u.iD)("div",Q,[(0,u._)("div",{class:"goback",onClick:l[0]||(l[0]=e=>(0,r.SU)(a).push("/"))},"返回管理菜单"),(0,u._)("div",{class:"wraper wraper-left",style:(0,s.j5)({width:h.value?"50%":"100%"})},Y,4),(0,u._)("div",{class:"wraper wraper-right",style:(0,s.j5)({width:h.value?"50%":"0%",borderLeft:h.value?"1px solid #fff":"none"})},J,4),"main"===k.value?((0,u.wg)(),(0,u.iD)("div",X,[(0,u._)("div",ee,[(0,u._)("div",null,(0,s.zw)(b.label),1),(0,u._)("div",{class:"menu-item",onClick:z},(0,s.zw)(h.value?"切换单个场景":"看对比"),1)]),(0,u._)("div",le,[(0,u._)("div",{class:"menu-item",onClick:l[1]||(l[1]=e=>k.value="leftPano")},(0,s.zw)(h.value?"换全景(左)":"换全景"),1),(0,u._)("div",{class:"menu-item",onClick:l[2]||(l[2]=e=>k.value="leftScene")},(0,s.zw)(h.value?"换场景(左)":"换场景"),1),h.value?((0,u.wg)(),(0,u.iD)("div",{key:0,class:"menu-item",onClick:l[3]||(l[3]=e=>k.value="rightPano")},"换全景(右)")):(0,u.kq)("",!0),h.value?((0,u.wg)(),(0,u.iD)("div",{key:1,class:"menu-item",onClick:l[4]||(l[4]=e=>k.value="rightScene")},"换场景(右)")):(0,u.kq)("",!0)])])):(0,u.kq)("",!0),"leftPano"===k.value||"rightPano"===k.value?((0,u.wg)(),(0,u.iD)("div",ae,[(0,u._)("div",ne,[(0,u._)("div",null,(0,s.zw)(h.value?"leftPano"===k.value?"左视图":"右视图":""),1),(0,u._)("div",{class:"menu-item",onClick:l[5]||(l[5]=e=>k.value="main")},"返回")]),(0,u._)("div",te,["leftPano"===k.value?((0,u.wg)(),(0,u.j4)(t,{key:0,modelValue:d.value,"onUpdate:modelValue":l[6]||(l[6]=e=>d.value=e),class:"ml-4",onChange:l[7]||(l[7]=e=>V(e,k.value))},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(b.children,(e=>((0,u.wg)(),(0,u.j4)(n,{key:e.id,label:e.id,size:"large"},{default:(0,u.w5)((()=>[(0,u._)("span",oe,(0,s.zw)(e.name),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])):(0,u.kq)("",!0),"rightPano"===k.value?((0,u.wg)(),(0,u.j4)(t,{key:1,modelValue:m.value,"onUpdate:modelValue":l[8]||(l[8]=e=>m.value=e),class:"ml-4",onChange:l[9]||(l[9]=e=>V(e,k.value))},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(b.children,(e=>((0,u.wg)(),(0,u.j4)(n,{key:e.id,label:e.id,size:"large"},{default:(0,u.w5)((()=>[(0,u._)("span",ie,(0,s.zw)(e.name),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])):(0,u.kq)("",!0)])])):(0,u.kq)("",!0),"leftScene"===k.value||"rightScene"===k.value?((0,u.wg)(),(0,u.iD)("div",ue,[(0,u._)("div",re,[(0,u._)("div",null,(0,s.zw)(h.value?"leftScene"===k.value?"左视图":"右视图":""),1),(0,u._)("div",{class:"menu-item",onClick:l[10]||(l[10]=e=>k.value="main")},"返回")]),"leftScene"===k.value?((0,u.wg)(),(0,u.iD)("div",se,[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(v.value,(e=>((0,u.wg)(),(0,u.iD)("div",{key:e.id,class:"menu-scene",onClick:l=>I(e)},[(0,u._)("img",{src:e.thumburl,alt:""},null,8,de),(0,u._)("span",null,(0,s.zw)(e.title),1)],8,ce)))),128))])):(0,u.kq)("",!0),"rightScene"===k.value?((0,u.wg)(),(0,u.iD)("div",me,[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(f.value,(e=>((0,u.wg)(),(0,u.iD)("div",{key:e.id,class:"menu-scene",onClick:l=>I(e)},[(0,u._)("img",{src:e.thumburl,alt:""},null,8,fe),(0,u._)("span",null,(0,s.zw)(e.title),1)],8,ve)))),128))])):(0,u.kq)("",!0)])):(0,u.kq)("",!0)])}}};const ge=(0,E.Z)(pe,[["__scopeId","data-v-38bffafc"]]);var he=ge;const we=[{name:"Management",path:"/",component:$},{name:"KrpanoViewer",path:"/viewer",component:he}],ke=(0,i.p7)({history:(0,i.r5)(),routes:we});var ye=ke;const _e={class:"app","element-loading-text":"正在加载全景数据...","element-loading-background":"rgba(0, 0, 0, 0.8)"};var be={__name:"App",setup(e){const l=(0,r.iH)(!1),a=w();return a.getPanoTree().then((()=>{l.value=!0})),(e,n)=>{const t=(0,u.up)("router-view"),o=(0,u.Q2)("loading");return(0,u.wy)(((0,u.wg)(),(0,u.iD)("div",_e,[l.value?((0,u.wg)(),(0,u.j4)(t,{key:0})):(0,u.kq)("",!0)])),[[o,!(0,r.SU)(a).loading]])}}};const Ce=be;var Pe=Ce;(0,n.ri)(Pe).use((0,t.WB)()).use(ye).use(o.Z).mount("#app")}},l={};function a(n){var t=l[n];if(void 0!==t)return t.exports;var o=l[n]={exports:{}};return e[n].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(l,n,t,o){if(!n){var i=1/0;for(c=0;c<e.length;c++){n=e[c][0],t=e[c][1],o=e[c][2];for(var u=!0,r=0;r<n.length;r++)(!1&o||i>=o)&&Object.keys(a.O).every((function(e){return a.O[e](n[r])}))?n.splice(r--,1):(u=!1,o<i&&(i=o));if(u){e.splice(c--,1);var s=t();void 0!==s&&(l=s)}}return l}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[n,t,o]}}(),function(){a.n=function(e){var l=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(l,{a:l}),l}}(),function(){a.d=function(e,l){for(var n in l)a.o(l,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:l[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,l){return Object.prototype.hasOwnProperty.call(e,l)}}(),function(){var e={143:0};a.O.j=function(l){return 0===e[l]};var l=function(l,n){var t,o,i=n[0],u=n[1],r=n[2],s=0;if(i.some((function(l){return 0!==e[l]}))){for(t in u)a.o(u,t)&&(a.m[t]=u[t]);if(r)var c=r(a)}for(l&&l(n);s<i.length;s++)o=i[s],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(c)},n=self["webpackChunkqjt_test"]=self["webpackChunkqjt_test"]||[];n.forEach(l.bind(null,0)),n.push=l.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(1744)}));n=a.O(n)})();
//# sourceMappingURL=app.a1ca1783.js.map